<!-- {"title": "Convergence Mush Character Page", "slug": "characters/:key"} -->

<div class="character">
	<div class="banner">
		<h2 class="name"></h2>
	</div>
	<div class="body">
		<div class="profile">
			<h3>Profile</h3>
			<div class="staff">
				STAFF
			</div>
			<div class="portrait">
			</div>
			<table class="finger">
			</table>
		</div>
		<div class="data">
			<div class="sheet">
				<h3>Sheet</h3>
			</div>
			<div class="gallery">
				<h3>Gallery</h3>
			</div>
			<div class="logs">
				<h3>Logs</h3>
			</div>
		</div>
	</div>
</div>

<p><a href="/">Go back to the home page.</a></p>

<script>
document.addEventListener("DOMContentLoaded", async () => {
	const res = await fetch(`/api/characters/get/${encodeURIComponent("{{ dbref }}")}`)
	const character = await res.json()
	window.character = character

	const oldTitle = document.querySelector("title").innerText
	document.querySelector("title").innerText = `${character.name} — ${oldTitle}`

	document.querySelector(".character .banner .name").innerText = character.name

	if(character.bittype != "1") {
		document.querySelector(".character .body .profile").classList.add("staff")
	}

	for(key of Object.keys(character.finger).sort()) {
		const value =u character.finger[key]
		const entry = document.createElement("tr")
		const entryKey = document.createElement("td")
		entryKey.classList.add("key")
		entryKey.innerText = key
		const entryValue = document.createElement("td")
		entryValue.innerText = value
		entryValue.classList.add("value")
		entry.appendChild(entryKey)
		entry.appendChild(entryValue)
		document.querySelector(".character .body .profile .finger").appendChild(entry)
	}
})

// Expandable web component

<!-- Expandable Component Example
<expandable-item name="Component Name" summary="Summary text goes here">
	<p>Full content appears here when expanded.</p>
</expandable-item>
-->


class ExpandableItem extends HTMLElement {
	constructor() {
		super()
		this.attachShadow({ mode: "open" })
	}

	connectedCallback() {
		const name = this.getAttribute("name") || "Item"
		const summary = this.getAttribute("summary") || ""
		
		this.shadowRoot.innerHTML = `
			<style>
				:host {
					display: block;
				}
				
				.expandable-item {
					border: 1px solid #ccc;
					border-radius: 4px;
					margin-bottom: 1rem;
					overflow: hidden;
				}
				
				.expandable-header {
					display: flex;
					justify-content: space-between;
					align-items: center;
					padding: 1rem;
					background-color: #f5f5f5;
					cursor: pointer;
					transition: background-color 0.2s ease;
				}
				
				.expandable-header:hover {
					background-color: #efefef;
				}
				
				.expandable-content-preview {
					flex: 1;
				}
				
				.expandable-name {
					margin: 0 0 0.5rem 0;
					font-size: 1.1rem;
				}
				
				.expandable-summary {
					margin: 0;
					color: #666;
					font-size: 0.95rem;
				}
				
				.expandable-arrow {
					display: inline-block;
					margin-left: 1rem;
					transition: transform 0.3s ease;
					font-size: 0.8rem;
					color: #333;
				}
				
				.expandable-arrow.expanded {
					transform: rotate(90deg);
				}
				
				.expandable-body {
					padding: 1rem;
					background-color: #fafafa;
					border-top: 1px solid #ccc;
					display: none;
				}
				
				.expandable-body.expanded {
					display: block;
				}
			</style>
			
			<div class="expandable-item">
				<div class="expandable-header">
					<div class="expandable-content-preview">
						<h4 class="expandable-name">${name}</h4>
						<p class="expandable-summary">${summary}</p>
					</div>
					<span class="expandable-arrow">▶</span>
				</div>
				<div class="expandable-body">
					<slot></slot>
				</div>
			</div>
		`
		
		const header = this.shadowRoot.querySelector(".expandable-header")
		const body = this.shadowRoot.querySelector(".expandable-body")
		const arrow = this.shadowRoot.querySelector(".expandable-arrow")
		
		header.addEventListener("click", () => {
			body.classList.toggle("expanded")
			arrow.classList.toggle("expanded")
		})
	}
}

customElements.define("expandable-item", ExpandableItem)
</script>
